jQuery(function($){({init:function(){var self=this;self.watch={},self.requirements={},$('.wpbdp-settings-setting[data-requirements][data-requirements!=""]').each(function(){var setting_id=$(this).data("setting-id"),reqs=$(this).data("requirements");self.requirements[setting_id]=reqs,$.each(reqs,function(i,req){req=req[0];void 0===self.watch[req]&&(self.watch[req]=[]),self.watch[req].push(setting_id)})}),$.each(self.watch,function(setting_id,affected_settings){setting_id=setting_id.replace("!",""),$('[name="wpbdp_settings['+setting_id+']"], [name="wpbdp_settings['+setting_id+'][]"]').change(function(){$.each(affected_settings,function(i,v){self.check_requirements(v)})})}),$.each(self.requirements,function(setting_id,reqs){self.check_requirements(setting_id)}),$.fn.wpColorPicker&&$(".cpa-color-picker").wpColorPicker()},check_requirements:function(setting_id){for(var reqs=this.requirements[setting_id],$setting=$("#wpbdp-settings-"+setting_id),$row=$setting.closest(".wpbdp-setting-row"),passes=!0,i=0;i<reqs.length;i++){var req_name=reqs[i][0].replace("!",""),not=-1!==reqs[i][0].indexOf("!"),value=reqs[i][1],$rel_setting=$("#wpbdp-settings-"+req_name);if(0<$rel_setting.length&&(value=!$rel_setting.closest(".wpbdp-setting-row").hasClass("wpbdp-setting-disabled")&&($rel_setting.hasClass("wpbdp-settings-type-select")?""!==$rel_setting.find('[name="wpbdp_settings['+req_name+']"]').val():0<$rel_setting.find('[name="wpbdp_settings['+req_name+']"]:checked, [name="wpbdp_settings['+req_name+'][]"]:checked').length)),!(passes=not?!value:value))break}passes?$row.removeClass("wpbdp-setting-disabled"):$row.addClass("wpbdp-setting-disabled"),void 0!==this.watch[setting_id]&&$setting.find('[name="wpbdp_settings['+setting_id+']"], [name="wpbdp_settings['+setting_id+'][]"]').trigger("change")}}).init(),{init:function(){0!=$(".wpbdp-settings-type-license_key").length&&$(".wpbdp-license-key-activate-btn, .wpbdp-license-key-deactivate-btn").click(function(e){e.preventDefault();var $button=$(this),$setting=$(this).parents(".wpbdp-license-key-activation-ui"),$msg=$setting.find(".wpbdp-license-key-activation-status-msg"),activate=($setting.find(".spinner"),$(this).is(".wpbdp-license-key-activate-btn")),$field=$setting.find("input.wpbdp-license-key-input"),e=$setting.data("licensing");$msg.hide(),$button.data("original_label",$(this).val()),$button.val($(this).data("working-msg")),$button.prop("disabled",!0),e.action=activate?"wpbdp_activate_license":"wpbdp_deactivate_license",e.license_key=$field.val(),$.post(ajaxurl,e,function(res){var classes;res.success?($msg.removeClass("status-error notice-error").addClass("status-success notice-success").html(res.message).show(),activate?((classes=$setting.attr("class").split(" ").filter(function(item){item=item.trim();return 0!==item.length&&!item.match(/^wpbdp-license-status/)})).push("wpbdp-license-status-valid"),$setting.attr("class",classes.join(" "))):$setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid"),$field.prop("readonly",!!activate)):($msg.removeClass("status-success notice-success").addClass("status-error notice-error").html(res.error).show(),$setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid"),$field.prop("readonly",!1)),$button.val($button.data("original_label")),$button.prop("disabled",!1)},"json")})}}.init(),{init:function(){$(".wpbdp-settings-email-preview, .wpbdp-settings-email-edit-btn").click(function(e){e.preventDefault();e=$(this).parents(".wpbdp-settings-email");$(this).hide(),e.find(".wpbdp-settings-email-editor").show()}),$(".wpbdp-settings-email-editor .cancel").click(function(e){e.preventDefault();var subject,body,e=$(this).parents(".wpbdp-settings-email"),$editor=e.find(".wpbdp-settings-email-editor");(e.parent().is("#wpbdp-settings-expiration-notices-add")?(e.hide(),$("#wpbdp-settings-expiration-notices-add-btn")):(subject=$editor.find(".stored-email-subject").val(),body=$editor.find(".stored-email-body").val(),$editor.find(".email-subject").val(subject),$editor.find(".email-body").val(body),e.hasClass("wpbdp-expiration-notice-email")&&(subject=$editor.find(".stored-notice-event").val(),body=$editor.find(".stored-notice-relative-time").val(),$editor.find(".notice-event").val(subject),$editor.find(".notice-relative-time").val(body),body=body||"0 days",$editor.find("select.relative-time-and-event").val(subject+","+body)),$editor.hide(),e.find(".wpbdp-settings-email-preview"))).show()}),$(".wpbdp-settings-email-editor .delete").click(function(e){e.preventDefault();e=$(this).parents(".wpbdp-settings-email");e.find("input.email-subject").val(""),e.find("input.email-body").val(""),$("#wpbdp-admin-page-settings form:first").submit()}),$(".wpbdp-expiration-notice-email select.relative-time-and-event").change(function(e){var parts=$(this).val().split(","),event=parts[0],parts=parts[1],$email=$(this).parents(".wpbdp-settings-email");$email.find(".notice-event").val(event),$email.find(".notice-relative-time").val(parts)}),$("#wpbdp-settings-expiration-notices-add-btn").click(function(e){e.preventDefault();var e=$("#wpbdp-settings-expiration-notices-add .wpbdp-expiration-notice-email"),$editor=e.find(".wpbdp-settings-email-editor");$(this).hide(),e.show(),$editor.show()}),$('#wpbdp-settings-expiration-notices-add input[type="submit"]').click(function(e){return $(this).parents(".wpbdp-settings-email-editor").find("input, textarea, select").each(function(i){var name=$(this).attr("name");name&&-1!=name.indexOf("new_notice")&&(name=name.replace("new_notice","wpbdp_settings[expiration-notices]"),$(this).prop("name",name))}),!0})}}.init()});