jQuery(function($){var wpbdp_settings_dep_handling={init:function(){var self=this;"undefined"!=typeof wpbdp_settings_data&&"undefined"!=typeof wpbdp_settings_data.requirements&&wpbdp_settings_data.requirements&&(this.data=wpbdp_settings_data.requirements,this.watch=wpbdp_settings_data.watch,this.selector='input[name="wpbdp_settings[SID]"], input[name="wpbdp_settings[SID][]"], select[name="wpbdp_settings[SID]"], select[name="wpbdp_settings[SID][]"]',$.each(this.watch,function(setting_id,affected_settings){$(self.selector.replace("SID",setting_id)).change(function(){$.each(affected_settings,function(i,v){self.check_requirements(v)})}).trigger("change")}))},check_requirements:function(setting_id){for(var reqs=this.data[setting_id],$setting=$("#wpbdp-settings-"+setting_id),$row=$setting.parents("tr"),passes=!0,i=0;i<reqs.length;i++){var rel_setting=reqs[i].setting_id,operator=reqs[i].operator,req_value=reqs[i].req_value,value=reqs[i].current_value,$rel_setting=$("#wpbdp-settings-"+rel_setting);if($rel_setting.length>0){var $field=$rel_setting.find(this.selector.replace("SID",rel_setting));if($field.length>0)if($field.is('input[type="checkbox"]')){var $checked=$field.filter(":checked");value=$checked.length>0&&$checked.val()}else $field.is('input[type="radio"]')?console.log(rel_setting,"radio"):$field.is("select")&&console.log(rel_setting,"select")}if("="==operator?passes=value==req_value:"!="==operator&&(passes=value!=req_value),!passes)break}passes?$row.removeClass("wpbdp-setting-disabled"):$row.addClass("wpbdp-setting-disabled")}};wpbdp_settings_dep_handling.init();var wpbdp_settings_licensing={init:function(){0!=$(".wpbdp-settings-type-license_key").length&&$(".wpbdp-license-key-activate-btn, .wpbdp-license-key-deactivate-btn").click(function(e){e.preventDefault();var $button=$(this),$setting=$(this).parents(".wpbdp-license-key-activation-ui"),$msg=$setting.find(".wpbdp-license-key-activation-status-msg"),activate=($setting.find(".spinner"),$(this).is(".wpbdp-license-key-activate-btn")),$field=$setting.find("input.wpbdp-license-key-input"),data=$setting.data("licensing");$msg.hide(),$button.data("original_label",$(this).val()),$button.val($(this).data("working-msg")),$button.prop("disabled",!0),activate?data.action="wpbdp_activate_license":data.action="wpbdp_deactivate_license",data.license_key=$field.val(),$.post(ajaxurl,data,function(res){res.success?($msg.removeClass("status-error").addClass("status-success").html(res.message).show(),activate?$setting.removeClass("wpbdp-license-status-invalid").addClass("wpbdp-license-status-valid"):$setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid"),$field.prop("readonly",!!activate)):($msg.removeClass("status-success").addClass("status-error").html(res.error).show(),$setting.removeClass("wpbdp-license-status-valid").addClass("wpbdp-license-status-invalid"),$field.prop("readonly",!1)),$button.val($button.data("original_label")),$button.prop("disabled",!1)},"json")})}};wpbdp_settings_licensing.init();var wpbdp_settings_email={init:function(){$(".wpbdp-settings-email-preview, .wpbdp-settings-email-edit-btn").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email");$(this).hide(),$email.find(".wpbdp-settings-email-editor").show()}),$(".wpbdp-settings-email-editor .cancel").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email"),$editor=$email.find(".wpbdp-settings-email-editor");if($email.parent().is("#wpbdp-settings-expiration-notices-add"))return $email.hide(),void $("#wpbdp-settings-expiration-notices-add-btn").show();var subject=$editor.find(".stored-email-subject").val(),body=$editor.find(".stored-email-body").val();if($editor.find(".email-subject").val(subject),$editor.find(".email-body").val(body),$email.hasClass("wpbdp-expiration-notice-email")){var event=$editor.find(".stored-notice-event").val(),reltime=$editor.find(".stored-notice-relative-time").val();$editor.find(".notice-event").val(event),$editor.find(".notice-relative-time").val(reltime),reltime||(reltime="0 days"),$editor.find("select.relative-time-and-event").val(event+","+reltime)}$editor.hide(),$email.find(".wpbdp-settings-email-preview").show()}),$(".wpbdp-settings-email-editor .delete").click(function(e){e.preventDefault();var $email=$(this).parents(".wpbdp-settings-email");$email.next().remove(),$email.remove(),$("#wpbdp-admin-page-settings form").get(0).submit()}),$(".wpbdp-expiration-notice-email select.relative-time-and-event").change(function(e){var parts=$(this).val().split(","),event=parts[0],relative_time=parts[1],$email=$(this).parents(".wpbdp-settings-email");$email.find(".notice-event").val(event),$email.find(".notice-relative-time").val(relative_time)}),$("#wpbdp-settings-expiration-notices-add-btn").click(function(e){e.preventDefault();var $container=$("#wpbdp-settings-expiration-notices-add .wpbdp-expiration-notice-email"),$editor=$container.find(".wpbdp-settings-email-editor");$(this).hide(),$container.show(),$editor.show()}),$('#wpbdp-settings-expiration-notices-add input[type="submit"]').click(function(e){var $editor=$(this).parents(".wpbdp-settings-email-editor");$editor.find("input, textarea, select").each(function(i){var name=$(this).attr("name");name&&-1!=name.indexOf("new_notice")&&$(this).prop("name",name.replace("new_notice","wpbdp-expiration-notices"))})})}};wpbdp_settings_email.init()});