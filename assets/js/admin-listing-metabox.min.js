jQuery(function($){function _addNeverButton(instance){setTimeout(function(){var $button,$buttonPane=$(instance.dpDiv).find(".ui-datepicker-buttonpane");0<$buttonPane.find(".ui-datepicker-never").length||($button=$("<button>",{text:"Never Expires",click:function(){$(instance.input).val(""),$(instance.input).datepicker("hide")}}).addClass("ui-datepicker-never ui-state-default ui-priority-primary ui-corner-all"),$buttonPane.append($button))},1)}$('#wpbdp-listing-metabox-plan-info input[name="listing_plan[expiration_date]"]').datepicker({dateFormat:"yy-mm-dd",showButtonPanel:!0,beforeShow:function(input,instance){_addNeverButton(instance),$("#ui-datepicker-div").addClass("wpbdp-datepicker")},onChangeMonthYear:function(year,month,instance){_addNeverButton(instance)}});var $metabox_tab=$("#wpbdp-listing-metabox-plan-info");setTimeout(function(){var planPos,publishBtn,featured=document.querySelector(".editor-post-featured-image"),featured=(null!==featured&&featured.closest(".components-panel__body").classList.add("hidden"),document.querySelector('input[name="listing_plan[fee_id]"]'));null===featured||featured.value||null!==(publishBtn=document.querySelector(".edit-post-header__settings .is-primary"))&&(publishBtn.classList.add("wpbdp-error-btn"),publishBtn.title="The Listing plan is required.",featured=document.querySelector(".interface-interface-skeleton__sidebar"),planPos=document.getElementById("wpbdp-listing-plan").getBoundingClientRect(),null!==featured&&(featured.scrollTop=planPos.y),$metabox_tab.on("change",'input[name="listing_plan[fee_id]"]',function(){publishBtn.classList.remove("wpbdp-error-btn"),publishBtn.title=""}))},3500),$metabox_tab.on("click","a.edit-value-toggle",function(e){e.preventDefault();var e=$(this).parents("dd"),$editor=e.find(".value-editor"),e=e.find(".display-value"),$input=$editor.find('input[type="text"], input[type="checkbox"], select'),current_value=$input.is(":checkbox")?$input.is(":checked"):$input.val();$input.data("before-edit-value",current_value),$(this).hide(),e.hide(),$editor.show()}),$metabox_tab.on("click",".value-editor a.update-value, .value-editor a.cancel-edit",function(e){e.preventDefault();var prev_value,e=$(this).parents("dd"),$editor=e.find(".value-editor"),$display=e.find(".display-value"),$input=$editor.find('input[type="text"], input[type="checkbox"], select');$(this).is(".cancel-edit")?(prev_value=$input.data("before-edit-value"),$input.is(":checkbox")?$input.prop("checked",prev_value):$input.val(prev_value)):$input.is("#wpbdp-listing-plan-select")&&$input.val()?(prev_value=$('input[name="post_ID"]').val(),$.ajax(ajaxurl,{data:{action:"wpbdp-assign-plan-to-listing",nonce:wpbdp_global.nonce,listing_id:prev_value,plan_id:$input.val()},type:"POST",dataType:"json",success:function(res){res.success&&(res=res.data,$metabox_tab.find('input[name="listing_plan[fee_id]"]').val(res.id),$metabox_tab.find('input[name="listing_plan[expiration_date]"]').val(res.expiration_date),$metabox_tab.find('input[name="listing_plan[fee_images]"]').val(res.images),function(plan){var images=$('input[name="listing_plan[fee_images]"]').val();$("#wpbdp-listing-plan-prop-images").html(images),plan&&($("#wpbdp-listing-plan-prop-label").html(wpbdpListingMetaboxL10n.planDisplayFormat.replace("{{plan_id}}",plan.id).replace("{{plan_label}}",plan.label)),$("#wpbdp-listing-plan-prop-amount").html(plan.amount||"-"),$("#wpbdp-listing-plan-prop-is_sticky").html(plan.sticky),$("#wpbdp-listing-plan-prop-is_recurring").html(plan.recurring),$("#wpbdp-listing-plan-prop-expiration").html(plan.formated_date))}(res))}})):$display.html($input.val()),$editor.hide(),$display.show(),e.find(".edit-value-toggle").show()}),($payments_tab=$("#wpbdp-listing-metabox-payments")).on("click",'a[name="delete-payments"]',function(e){e.preventDefault(),$.post(ajaxurl,{action:"wpbdp-clear-payment-history",listing_id:$(this).attr("data-id")},function(res){res.success?$(".wpbdp-payment-items",$payments_tab).fadeOut("fast",function(){$(this).html(""),$("#wpbdp-listing-payment-message",$payments_tab).html(res.data.message).fadeIn()}):res.data.error&&$("#wpbdp-listing-payment-message").addClass("error").html(res.data.error).fadeIn()})})});