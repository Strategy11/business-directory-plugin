(()=>{"use strict";var e;e=function(){var e;e=function(e){var t=e.closest(".wpbdp-setting-row"),r=t.querySelector(".wpbdp-setting-label");return{mainWrapper:t,labelWrapper:r,label:r.querySelector("label")}},["input[name=csv-file]","input[name=images-file]"].forEach((function(t){var r=document.querySelector(t);r&&r.addEventListener("change",(function(){!function(t){var r=e(t);r.label.style.color="",r.mainWrapper.querySelectorAll(".wpbdp-csv-import-error").forEach((function(e){return e.remove()})),0===document.querySelectorAll(".wpbdp-csv-import-error").length&&document.querySelectorAll(".submit input[type=submit]").forEach((function(e){return e.disabled=!1}))}(r);var t=r.files[0];t&&t.size>window.wpbdp_admin_import.maxFileSize&&function(t){var r=e(t);r.label.style.color="red";var s=document.createElement("p");s.classList.add("wpbdp-csv-import-error"),s.textContent=window.wpbdp_admin_import.error_label,r.labelWrapper.appendChild(s),document.querySelectorAll(".submit input[type=submit]").forEach((function(e){return e.disabled=!0}))}(r)}))}))},"undefined"!=typeof document&&("complete"!==document.readyState&&"interactive"!==document.readyState?document.addEventListener("DOMContentLoaded",e):e()),jQuery((function(e){var t={CSV_Import:function(){this.import_id=e("#wpbdp-csv-import-state").attr("data-import-id"),this.in_progress=!1,this.canceled=!1,this.processed_rows=0,this.total_rows=0,this.imported_rows=0,this.rejected_rows=0,this.warnings=[],this.$state=e("#wpbdp-csv-import-state"),this.$success=e("#wpbdp-csv-import-summary"),this.$progress_bar=new WPBDP_Admin.ProgressBar(e(".import-progress")),this._setup_events()}};e.extend(t.CSV_Import.prototype,{_setup_events:function(){var t=this;e("a.cancel-import").on("click",(function(e){e.preventDefault(),t.cancel()})),e("a.resume-import").on("click",(function(e){e.preventDefault(),t.start_or_resume()}))},_advance:function(){var t=this;t.in_progress&&(t.in_progress&&t.canceled&&(t.in_progress=!1),e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpbdp-csv-import",import_id:t.import_id},success:function(e){if(!e||!e.success)return t._fatal_error(e.error);t.processed_rows=e.data.progress,t.total_rows=e.data.total,t.imported_rows=e.data.imported,t.rejected_rows=e.data.rejected,t.$progress_bar.set(t.processed_rows,t.total_rows),e.data.done?(t.in_progress=!1,t.warnings=e.data.warnings,t._show_success_screen()):t._advance()},error:function(){return t._fatal_error()}}))},_show_success_screen:function(){var t=this;t.$state.fadeOut((function(){if(t.$state.remove(),t.$success.find(".placeholder-imported-rows").html(t.imported_rows),t.$success.find(".placeholder-rejected-rows").html(t.rejected_rows),0==t.warnings.length)return t.$success.find(".no-warnings").show(),void t.$success.fadeIn("fast");var r=t.$success.find(".wpbdp-csv-import-warnings tbody"),s=r.find(".row-template");e.each(t.warnings,(function(e,t){var n=s.clone();n.find(".col-line-no").html(t.line),n.find(".col-line-content").html(t.content),n.find(".col-warning").html(t.error),r.append(n.show())})),t.$success.find(".with-warnings").show(),t.$success.find(".wpbdp-csv-import-warnings").show(),t.$success.fadeIn("fast")}))},_fatal_error:function(t){var r=e("#wpbdp-csv-import-fatal-error"),s=r.find(".with-reason"),n=r.find(".no-reason");t?s.html(s.html().replace("%s",t)).show():n.show(),r.show(),e("html, body").animate({scrollTop:0},"medium"),this.cancel()},start_or_resume:function(){this.in_progress||this.canceled||(this.in_progress=!0,e("a.resume-import").css("opacity","0.4"),e(".status-msg .not-started").hide(),e(".status-msg .in-progress").show(),this._advance())},cancel:function(){var t=this;t.canceled=!0,e(".canceled-import").show(),t.$state.remove(),e.ajax({url:ajaxurl,type:"POST",dataType:"json",data:{action:"wpbdp-csv-import",import_id:t.import_id,cleanup:1}})}}),e("a.wpbdp-example-csv").on("click",(function(t){t.preventDefault(),e.ajax({url:ajaxurl,type:"POST",data:{action:"wpbdp-example-csv",nonce:wpbdp_global.nonce},success:function(e){var t=document.createElement("a"),r=new Blob(["\ufeff"+e],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(r);t.href=s,t.download="bd-example.csv",document.body.appendChild(t),t.click(),document.body.removeChild(t)}})})),e("#wpbdp-csv-import-state").length>0?new t.CSV_Import:(e(".wpbdp-page-csv-import .file-local-selection a.toggle-selection").on("click",(function(t){t.preventDefault();var r=e(this).siblings("ul");r.toggle(),r.is(":visible")||r.find('input[type="radio"]').prop("checked",!1)})),e(".wpbdp-page-csv-import").on("change",'.file-local-selection input[type="radio"]',(function(t){""==e(this).filter(":checked").val()&&(e(this).prop("checked",!1),e(this).parents(".file-local-selection").hide())})),function(){var t,r=e("form#wpbdp-csv-import-form"),s=r.find("input.use-default-listing-user");function n(e,r){e.preventDefault(),void 0!==r.item&&(t.val(r.item.label),t.siblings("#"+t.attr("data-hidden-field")).val(r.item.value))}r.on("change","input.assign-listings-to-user",(function(t){e(this).is(":checked")?r.find(".default-user-selection").show():r.find(".default-user-selection").hide(),s.trigger("change")})),e("input.assign-listings-to-user").trigger("change"),e(document).on("change",s,(function(){e(this).is(":checked")?r.find("select.default-user, input.default-user").closest("tr").show():r.find("select.default-user, input.default-user").closest("tr").hide()})),s.trigger("change"),t=r.find(".wpbdp-user-autocomplete").autocomplete({source:ajaxurl+"?action=wpbdp-autocomplete-user",delay:500,minLength:2,select:n,focus:n})}())}))})();