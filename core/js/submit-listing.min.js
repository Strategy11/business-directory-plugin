jQuery(function($){var submit_listing=wpbdp.submit_listing=wpbdp.submit_listing||{};if(submit_listing.Fee_Selection_Helper=function(){this.field=$(".wpbdp-form-field-association-category select"),this.is_multiple=this.field.prop("multiple"),this.plans=$(".wpbdp-plan-selection-list .wpbdp-plan"),this.selected_categories=[],this.available_plans=this.plans.map(function(){return $(this).data("id")}).get(),this.field.change($.proxy(this.categories_changed,this)),this.maybe_limit_category_options()},$.extend(submit_listing.Fee_Selection_Helper.prototype,{categories_changed:function(){this.selected_categories=this.field.val(),this.update_plan_list(),this.update_plan_prices(),this.maybe_limit_category_options()},maybe_limit_category_options:function(){var all_cats=!1,cats=[],self=this;return $.each(this.available_plans,function(i,v){if(!all_cats){var plan_cats=self.plans.filter('[data-id="'+v+'"]').data("categories");"all"==plan_cats?all_cats=!0:cats=$.unique(cats.concat(plan_cats.toString().split(",")))}}),all_cats?void this.field.find("option").prop("disabled",!1):void this.field.find("option").each(function(i,v){-1==$.inArray($(this).val(),cats)&&$(this).prop("disabled",!0)})},update_plan_list:function(){var self=this,plans=[];$.each(this.plans,function(i,v){var $plan=$(v),plan_cats=$plan.data("categories").toString().split(","),plan_supports_selection=!0;"all"!=plan_cats&&self.selected_categories&&$.each(self.selected_categories,function(j,c){plan_supports_selection&&-1==$.inArray(c,plan_cats)&&(plan_supports_selection=!1)}),plan_supports_selection?(plans.push($plan.data("id")),$plan.show()):$plan.hide()}),self.available_plans=plans},update_plan_prices:function(){var self=this;$.each(self.available_plans,function(i,plan_id){var $plan=self.plans.filter('[data-id="'+plan_id+'"]'),pricing=$plan.data("pricing-details"),price=null;switch($plan.data("pricing-model")){case"variable":price=0,$.each(self.selected_categories,function(j,cat_id){price+=parseFloat(pricing[cat_id])});break;case"extra":price=$plan.data("amount")+pricing.extra*self.selected_categories.length;break;case"flat":default:price=$plan.data("amount")}$plan.find(".wpbdp-plan-price-amount").text($plan.data("amount-format").replace("[amount]",price.toFixed(2)))})}}),$("#wpbdp-submit-listing .wpbdp-submit-listing-section-header").click(function(){var $section=$(this).parent(".wpbdp-submit-listing-section");$section.toggleClass("collapsed")}),$("#wpbdp-submit-listing .wpbdp-plan-selection-list").length>0){new submit_listing.Fee_Selection_Helper;$('input[name="listing_plan"]').change(function(){var $form=$("#wpbdp-submit-listing form"),data=$form.serialize();data+="&action=wpbdp_ajax&handler=submit_listing__sections",$.post($form.attr("data-ajax-url"),data,function(res){if(!res.success)return void alert("Something went wrong!");var current_sections=$form.find(".wpbdp-submit-listing-section"),new_sections=res.data.sections;$.each(new_sections,function(section_id,section_details){var $section=current_sections.filter('[data-section-id="'+section_id+'"]'),$new_html=$(section_details.html);$section.attr("class",$new_html.attr("class")),$section.find(".wpbdp-submit-listing-section-content").fadeOut("fast",function(){$(this).replaceWith($new_html.find(".wpbdp-submit-listing-section-content"))})})},"json")})}});