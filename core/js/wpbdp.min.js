if(typeof(window.WPBDP)=="undefined"){window.WPBDP={}}if(typeof(window.wpbdp)=="undefined"){window.wpbdp={}}jQuery(document).ready(function($){$(".listing-actions input.delete-listing").click(function(e){var message=$(this).attr("data-confirmation-message");if(confirm(message)){return true}return false});if($(".wpbdp-bar").children().length==0&&$.trim($(".wpbdp-bar").text())==""){$(".wpbdp-bar").remove()}});WPBDP.fileUpload={resizeIFrame:function(field_id,height){var iframe=jQuery("#wpbdp-upload-iframe-"+field_id)[0];var iframeWin=iframe.contentWindow||iframe.contentDocument.parentWindow;if(iframeWin.document.body){iframe.height=iframeWin.document.documentElement.scrollHeight||iframeWin.document.body.scrollHeight}},handleUpload:function(o){var $input=jQuery(o);var $form=$input.parent("form");$form.submit()},finishUpload:function(field_id,upload_id){var $iframe=jQuery("#wpbdp-upload-iframe-"+field_id);var $input=jQuery('input[name="listingfields['+field_id+']"]');$input.val(upload_id);var $preview=$input.siblings(".preview");$preview.find("img").remove();$preview.prepend($iframe.contents().find(".preview").html());$iframe.contents().find(".preview").remove();$preview.find(".delete").show()},deleteUpload:function(field_id){var $input=jQuery('input[name="listingfields['+field_id+']"]');var $preview=$input.siblings(".preview");$input.val("");$preview.find("img").remove();$preview.find(".delete").hide();return false}};(function($){var sb=wpbdp.listingSubmit={init:function(){if($(".wpbdp-submit-page.step-images").length>0){sb.images.init()}}};var sbImages=sb.images=wpbdp.listingSubmit.images={_slots:0,_slotsRemaining:0,_working:false,init:function(){var t=this;sb.images._slots=parseInt($("#image-slots-total").text());sb.images._slotsRemaining=parseInt($("#image-slots-remaining").text());$("#wpbdp-uploaded-images").delegate(".delete-image","click",function(e){e.preventDefault();var url=$(this).attr("data-action");$.post(url,{state:$('form#wpbdp-listing-form-images input[name="_state"]').val()},function(res){if(!res.success){return}$('#wpbdp-uploaded-images .wpbdp-image[data-imageid="'+res.data.imageId+'"]').fadeOut(function(){$(this).remove();t._slotsRemaining++;$("#image-slots-remaining").text(t._slotsRemaining);if(t._slotsRemaining==t._slots){$("#no-images-message").show()}})},"json")});$("#image-upload-input").fileupload({url:"/wp-admin/admin-ajax.php",sequentialUploads:true,dataType:"json",formData:sb.images.formDataCallback,singleFileUploads:false,dropZone:$(".wpbdp-dnd-area"),send:function(e,data){if(this._working){return false}$("#image-upload-dnd-area").removeClass("dragging");$("#image-upload-dnd-area").removeClass("error");this._working=true;$("#image-upload-dnd-area .dnd-area-inside").fadeOut("fast",function(){$("#image-upload-dnd-area .dnd-area-inside-working span").text(data.files.length);$("#image-upload-dnd-area .dnd-area-inside-working").fadeIn("fast")});return true},done:function(e,data){var res=data.result;if(!res.success){return}t._slotsRemaining-=res.data.attachmentIds.length;$("#image-slots-remaining").text(t._slotsRemaining);t._working=false;$("#image-upload-dnd-area .dnd-area-inside-working").fadeOut("fast",function(){if(0==t._slotsRemaining){$("#noslots-message").show();$("#image-upload-dnd-area").addClass("error");$("#image-upload-dnd-area .dnd-area-inside-error").fadeIn("fast")}else{$("#image-upload-dnd-area .dnd-area-inside").fadeIn("fast")}});$("#no-images-message").hide();$("#wpbdp-uploaded-images").append(res.data.html)}})},formDataCallback:function(form){return[{name:"action",value:"wpbdp-listing-submit-image-upload"},{name:"state",value:$('input[name="_state"]',form).val()}]}};$(document).ready(function(){if(0==$(".wpbdp-submit-page").length){return}sb.init()})})(jQuery);